// Generated by CoffeeScript 1.3.3

/*

Copyright (c) 2011-2012  Voicious

This program is free software: you can redistribute it and/or modify it under the terms of the
GNU Affero General Public License as published by the Free Software Foundation, either version
3 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
See the GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License along with this
program. If not, see <http://www.gnu.org/licenses/>.
*/


(function() {
  var Renderer, config, error, fs, jade;

  fs = require('fs');

  jade = require('./modules/jade');

  config = require('./config');

  error = require('./errorHandler');

  Renderer = {
    readJade: function(file) {
      var handler;
      try {
        return fs.readFileSync(file, 'utf8');
      } catch (e) {
        handler = new error.ErrorHandler;
        throw handler.throwError(e, 500);
      }
    },
    render: function(str, opts) {
      var handler, tmp;
      try {
        tmp = jade.compile(str, opts);
        return tmp(opts);
      } catch (e) {
        handler = new error.ErrorHandler;
        throw handler.throwError(e, 500);
      }
    },
    jadeRender: function(path, options) {
      var def_opts, file, opts, res;
      file = config.TPL_PATH + path;
      def_opts = {
        pretty: true,
        filename: file
      };
      for (opts in options) {
        def_opts[opts] = options[opts];
      }
      return res = this.render(this.readJade(file), def_opts);
    }
  };

  exports.Renderer = Renderer;

}).call(this);
